<label for="phonenumber">手机号码:</label>
<input type="number" name="phonenumber" id="phonenumber" placeholder="手机号码..">

<div style="display: inline-block;">
<input type="number" id="checknumber" placeholder="验证码..">
</div>

<a id="getCheckno" class="ui-btn ui-btn-inline" onclick="sendMessage()">获取验证码</a>


<a id="opencard" class="ui-btn">开通</a>




<script language="javascript" type="text/javascript">



  <!--校验手机号码的输入格式是否正确-->
  function checkMobile(str) {
    if(str==""){
      alert("手机号不能为空！");
    }
    else{
      var re = /^1\d{10}$/
      if (re.test(str)) {
        return true;
      } else {
        alert("手机号格式错误！");
      }
    }
  }

  function opencard(){

  }


  var InterValObj; //timer变量，控制时间
  var count = 5; //间隔函数，1秒执行
  var curCount;//当前剩余秒数

  function sendMessage() {
    var telephone = $("#phonenumber").val();
    if(!checkMobile(telephone)){
      return false;
    }

    curCount = count;
    //设置button效果，开始计时
    $("#getCheckno").prop('disabled',true).addClass("ui-disabled");
    $("#getCheckno").html(curCount + "秒后可重发");
    InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
    //向后台发送处理数据
    $.ajax({
      type: "get", //用POST方式传输
      dataType: "JSON", //数据格式:JSON
      url: '/membership/sendsms', //目标地址
      data: {"telephone":telephone},
      error: function (XMLHttpRequest, textStatus, errorThrown) { },
      success: function (msg){
        console.log(msg);
      }
    });

  }

  //timer处理函数
  function SetRemainTime() {
    if (curCount == 0) {
      window.clearInterval(InterValObj);//停止计时器

      $("#getCheckno").html("发送验证码");
      $("#getCheckno").prop('disabled',false).removeClass("ui-disabled");//启用按钮
    }
    else {
      curCount--;
      $("#getCheckno").html(curCount + "秒后可重发");
    }
  }

</script>


